name: Ghost Turbo Boost

on:
  workflow_dispatch: # This allows you to run it MANUALLY from the Actions tab

jobs:
  turbo_boost:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Inject Historical Activity (Python)
        run: |
          python3 -c "
          import os
          import subprocess
          from datetime import datetime, timedelta
          import random
          
          def run(cmd):
              subprocess.run(cmd, shell=True, check=True)

          run('git config --global user.name \"Ghost Booster\"')
          run('git config --global user.email \"73097560+abameda@users.noreply.github.com\"')

          today = datetime.now()
          # We go back 365 days and make several commits for each day
          for i in range(1, 366):
              d = today - timedelta(days=i)
              formatted_date = d.strftime('%Y-%m-%dT12:00:00')
              
              # Random number of commits (3 to 8) to make the grid look dense
              commits = random.randint(3, 8)
              
              for c in range(commits):
                  with open('.github/turbo_log.txt', 'a') as f:
                      # We need double backslash for the newline in the python string inside shell
                      f.write(f'Pulse {formatted_date} {c}\\n')
                  
                  run('git add .github/turbo_log.txt')
                  # Set both Author and Committer date to the past date
                  env = f'GIT_AUTHOR_DATE=\"{formatted_date}\" GIT_COMMITTER_DATE=\"{formatted_date}\"'
                  run(f'{env} git commit -m \"Ghost System Pulse [Historical Update]\"')
          "
          git push origin main --force
